/*!
 * FilePondPluginFilePoster 2.0.3
 * Licensed under MIT, https://opensource.org/licenses/MIT/
 * Please visit https://pqina.nl/filepond/ for details.
 */

/* eslint-disable */

const e={type:"spring",stiffness:.5,damping:.45,mass:10},t=(e,t,a=1,i=(e=>-.5*(Math.cos(Math.PI*e)-1)),o=10,r=0)=>{const n=1-r,c=t.join(",");for(let t=0;t<=o;t++){const s=t/o,d=r+n*s;e.addColorStop(d,`rgba(${c}, ${i(s)*a})`)}},a=e=>{const t=Math.min(10/e.width,10/e.height),a=document.createElement("canvas"),o=a.getContext("2d"),r=a.width=Math.ceil(e.width*t),n=a.height=Math.ceil(e.height*t);o.drawImage(e,0,0,r,n);let c=null;try{c=o.getImageData(0,0,r,n).data}catch(e){return null}const s=c.length;let d=0,l=0,p=0,E=0;for(;E<s;E+=4)d+=c[E]*c[E],l+=c[E+1]*c[E+1],p+=c[E+2]*c[E+2];return{r:d=i(d,s),g:l=i(l,s),b:p=i(p,s)}},i=(e,t)=>Math.floor(Math.sqrt(e/(t/4))),o=(e,a,i,o,r)=>{e.width=a,e.height=i;const n=e.getContext("2d"),c=.5*a,s=n.createRadialGradient(c,i+110,i-100,c,i+110,i+100);t(s,o,r,void 0,8,.4),n.save(),n.translate(.5*-a,0),n.scale(2,1),n.fillStyle=s,n.fillRect(0,0,a,i),n.restore()},r="undefined"!=typeof navigator,n=r&&document.createElement("canvas"),c=r&&document.createElement("canvas"),s=r&&document.createElement("canvas");r&&(o(n,500,200,[40,40,40],.85),o(c,500,200,[196,78,71],1),o(s,500,200,[54,151,99],1));const d=t=>{const i=(e=>e.utils.createView({name:"file-poster-overlay",tag:"canvas",ignoreRect:!0,create:({root:e,props:t})=>{((e,t)=>{t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0)})(t.template,e.element)},mixins:{styles:["opacity"],animations:{opacity:{type:"spring",mass:25}}}}))(t),o=({root:e})=>{e.ref.overlayShadow.opacity=1,e.ref.overlayError.opacity=0,e.ref.overlaySuccess.opacity=0},r=({root:e})=>{e.ref.overlayShadow.opacity=.25,e.ref.overlayError.opacity=1};return t.utils.createView({name:"file-poster-wrapper",create:({root:a,props:o})=>{const r=(t=>t.utils.createView({name:"file-poster",tag:"div",ignoreRect:!0,create:({root:e,props:t})=>{e.ref.image=document.createElement("img"),e.element.appendChild(e.ref.image)},write:t.utils.createRoute({DID_FILE_POSTER_LOAD:({root:e,props:t,action:a})=>{const{id:i}=t,o=e.query("GET_ITEM",{id:t.id});if(!o)return;const r=o.getMetadata("poster");e.ref.image.src=r,e.dispatch("DID_FILE_POSTER_DRAW",{id:i})}}),mixins:{styles:["scaleX","scaleY","opacity"],animations:{scaleX:e,scaleY:e,opacity:{type:"tween",duration:750}}}}))(t);a.ref.image=a.appendChildView(a.createChildView(r,{id:o.id,scaleX:1.25,scaleY:1.25,opacity:0})),a.ref.overlayShadow=a.appendChildView(a.createChildView(i,{template:n,opacity:0})),a.ref.overlaySuccess=a.appendChildView(a.createChildView(i,{template:s,opacity:0})),a.ref.overlayError=a.appendChildView(a.createChildView(i,{template:c,opacity:0}))},write:t.utils.createRoute({DID_FILE_POSTER_LOAD:({root:e,props:t})=>{e.ref.overlayShadow.opacity=1},DID_FILE_POSTER_DRAW:({root:e,props:t})=>{const{image:a}=e.ref;a.scaleX=1,a.scaleY=1,a.opacity=1},DID_FILE_POSTER_CONTAINER_CREATE:({root:e,props:t})=>{const{id:i}=t,o=e.query("GET_ITEM",i);if(!o)return;const r=o.getMetadata("poster"),n=t=>{const r=e.query("GET_FILE_POSTER_CALCULATE_AVERAGE_IMAGE_COLOR")?a(t):null;o.setMetadata("color",r,!0),e.dispatch("DID_FILE_POSTER_LOAD",{id:i,data:t})};((e,t)=>{let a=new Image;a.onload=(()=>{const e=a.naturalWidth,i=a.naturalHeight;a=null,t(e,i)}),a.src=e})(r,(t,a)=>{e.dispatch("DID_FILE_POSTER_CALCULATE_SIZE",{id:i,width:t,height:a}),(e=>new Promise((t,a)=>{const i=new Image;i.crossOrigin="Anonymous",i.onload=(()=>{t(i)}),i.onerror=(e=>{a(e)}),i.src=e}))(r).then(n)})},DID_THROW_ITEM_LOAD_ERROR:r,DID_THROW_ITEM_PROCESSING_ERROR:r,DID_THROW_ITEM_INVALID:r,DID_COMPLETE_ITEM_PROCESSING:({root:e})=>{e.ref.overlayShadow.opacity=.25,e.ref.overlaySuccess.opacity=1},DID_START_ITEM_PROCESSING:o,DID_REVERT_ITEM_PROCESSING:o})})},l=e=>{const{addFilter:t,utils:a}=e,{Type:i,createRoute:o}=a,r=d(e);return t("CREATE_VIEW",e=>{const{is:t,view:a,query:i}=e;if(!t("file")||!i("GET_ALLOW_FILE_POSTER"))return;a.registerWriter(o({DID_LOAD_ITEM:({root:e,props:t,actions:o})=>{const{id:n}=t,c=i("GET_ITEM",n);c&&c.getMetadata("poster")&&!c.archived&&(e.ref.filePoster=a.appendChildView(a.createChildView(r,{id:n})),e.dispatch("DID_FILE_POSTER_CONTAINER_CREATE",{id:n}))},DID_FILE_POSTER_CALCULATE_SIZE:({root:e,props:t,action:a})=>{e.ref.imageWidth=a.width,e.ref.imageHeight=a.height,e.ref.shouldUpdatePanelHeight=!0,e.dispatch("KICK")}},({root:e,props:t})=>{e.rect.element.hidden||e.ref.shouldUpdatePanelHeight&&(e.dispatch("DID_UPDATE_PANEL_HEIGHT",{id:t.id,height:e.rect.element.width*(e.ref.imageHeight/e.ref.imageWidth)}),e.ref.shouldUpdatePanelHeight=!1)}))}),{options:{allowFilePoster:[!0,i.BOOLEAN],filePosterCalculateAverageImageColor:[!1,i.BOOLEAN]}}};"undefined"!=typeof window&&void 0!==window.document&&document.dispatchEvent(new CustomEvent("FilePond:pluginloaded",{detail:l}));export default l;
