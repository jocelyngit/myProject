/*!
 * FilePondPluginFilePoster 2.0.3
 * Licensed under MIT, https://opensource.org/licenses/MIT/
 * Please visit https://pqina.nl/filepond/ for details.
 */

/* eslint-disable */

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).FilePondPluginFilePoster=t()}(this,function(){"use strict";var e={type:"spring",stiffness:.5,damping:.45,mass:10},t=function(e){return-.5*(Math.cos(Math.PI*e)-1)},a=function(e){var t=Math.min(10/e.width,10/e.height),a=document.createElement("canvas"),r=a.getContext("2d"),o=a.width=Math.ceil(e.width*t),n=a.height=Math.ceil(e.height*t);r.drawImage(e,0,0,o,n);var c=null;try{c=r.getImageData(0,0,o,n).data}catch(e){return null}for(var d=c.length,l=0,s=0,p=0,f=0;f<d;f+=4)l+=c[f]*c[f],s+=c[f+1]*c[f+1],p+=c[f+2]*c[f+2];return{r:l=i(l,d),g:s=i(s,d),b:p=i(p,d)}},i=function(e,t){return Math.floor(Math.sqrt(e/(t/4)))},r=function(e,a,i,r,o){e.width=a,e.height=i;var n=e.getContext("2d"),c=.5*a,d=n.createRadialGradient(c,i+110,i-100,c,i+110,i+100);!function(e,a){for(var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:10,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,c=1-n,d=a.join(","),l=0;l<=o;l++){var s=l/o,p=n+c*s;e.addColorStop(p,"rgba(".concat(d,", ").concat(r(s)*i,")"))}}(d,r,o,void 0,8,.4),n.save(),n.translate(.5*-a,0),n.scale(2,1),n.fillStyle=d,n.fillRect(0,0,a,i),n.restore()},o="undefined"!=typeof navigator,n=o&&document.createElement("canvas"),c=o&&document.createElement("canvas"),d=o&&document.createElement("canvas");o&&(r(n,500,200,[40,40,40],.85),r(c,500,200,[196,78,71],1),r(d,500,200,[54,151,99],1));var l=function(t){var i=t.utils.createView({name:"file-poster-overlay",tag:"canvas",ignoreRect:!0,create:function(e){var t,a,i=e.root,r=e.props;t=r.template,(a=i.element).width=t.width,a.height=t.height,a.getContext("2d").drawImage(t,0,0)},mixins:{styles:["opacity"],animations:{opacity:{type:"spring",mass:25}}}}),r=function(e){var t=e.root;t.ref.overlayShadow.opacity=1,t.ref.overlayError.opacity=0,t.ref.overlaySuccess.opacity=0},o=function(e){var t=e.root;t.ref.overlayShadow.opacity=.25,t.ref.overlayError.opacity=1};return t.utils.createView({name:"file-poster-wrapper",create:function(a){var r=a.root,o=a.props,l=function(t){return t.utils.createView({name:"file-poster",tag:"div",ignoreRect:!0,create:function(e){var t=e.root;e.props,t.ref.image=document.createElement("img"),t.element.appendChild(t.ref.image)},write:t.utils.createRoute({DID_FILE_POSTER_LOAD:function(e){var t=e.root,a=e.props,i=(e.action,a.id),r=t.query("GET_ITEM",{id:a.id});if(r){var o=r.getMetadata("poster");t.ref.image.src=o,t.dispatch("DID_FILE_POSTER_DRAW",{id:i})}}}),mixins:{styles:["scaleX","scaleY","opacity"],animations:{scaleX:e,scaleY:e,opacity:{type:"tween",duration:750}}}})}(t);r.ref.image=r.appendChildView(r.createChildView(l,{id:o.id,scaleX:1.25,scaleY:1.25,opacity:0})),r.ref.overlayShadow=r.appendChildView(r.createChildView(i,{template:n,opacity:0})),r.ref.overlaySuccess=r.appendChildView(r.createChildView(i,{template:d,opacity:0})),r.ref.overlayError=r.appendChildView(r.createChildView(i,{template:c,opacity:0}))},write:t.utils.createRoute({DID_FILE_POSTER_LOAD:function(e){var t=e.root;e.props;t.ref.overlayShadow.opacity=1},DID_FILE_POSTER_DRAW:function(e){var t=e.root,a=(e.props,t.ref.image);a.scaleX=1,a.scaleY=1,a.opacity=1},DID_FILE_POSTER_CONTAINER_CREATE:function(e){var t=e.root,i=e.props.id,r=t.query("GET_ITEM",i);if(r){var o,n,c,d=r.getMetadata("poster"),l=function(e){var o=t.query("GET_FILE_POSTER_CALCULATE_AVERAGE_IMAGE_COLOR")?a(e):null;r.setMetadata("color",o,!0),t.dispatch("DID_FILE_POSTER_LOAD",{id:i,data:e})};o=d,n=function(e,a){var r;t.dispatch("DID_FILE_POSTER_CALCULATE_SIZE",{id:i,width:e,height:a}),(r=d,new Promise(function(e,t){var a=new Image;a.crossOrigin="Anonymous",a.onload=function(){e(a)},a.onerror=function(e){t(e)},a.src=r})).then(l)},(c=new Image).onload=function(){var e=c.naturalWidth,t=c.naturalHeight;c=null,n(e,t)},c.src=o}},DID_THROW_ITEM_LOAD_ERROR:o,DID_THROW_ITEM_PROCESSING_ERROR:o,DID_THROW_ITEM_INVALID:o,DID_COMPLETE_ITEM_PROCESSING:function(e){var t=e.root;t.ref.overlayShadow.opacity=.25,t.ref.overlaySuccess.opacity=1},DID_START_ITEM_PROCESSING:r,DID_REVERT_ITEM_PROCESSING:r})})},s=function(e){var t=e.addFilter,a=e.utils,i=a.Type,r=a.createRoute,o=l(e);return t("CREATE_VIEW",function(e){var t=e.is,a=e.view,i=e.query;if(t("file")&&i("GET_ALLOW_FILE_POSTER")){a.registerWriter(r({DID_LOAD_ITEM:function(e){var t=e.root,r=e.props,n=(e.actions,r.id),c=i("GET_ITEM",n);c&&c.getMetadata("poster")&&!c.archived&&(t.ref.filePoster=a.appendChildView(a.createChildView(o,{id:n})),t.dispatch("DID_FILE_POSTER_CONTAINER_CREATE",{id:n}))},DID_FILE_POSTER_CALCULATE_SIZE:function(e){var t=e.root,a=(e.props,e.action);t.ref.imageWidth=a.width,t.ref.imageHeight=a.height,t.ref.shouldUpdatePanelHeight=!0,t.dispatch("KICK")}},function(e){var t=e.root,a=e.props;t.rect.element.hidden||t.ref.shouldUpdatePanelHeight&&(t.dispatch("DID_UPDATE_PANEL_HEIGHT",{id:a.id,height:t.rect.element.width*(t.ref.imageHeight/t.ref.imageWidth)}),t.ref.shouldUpdatePanelHeight=!1)}))}}),{options:{allowFilePoster:[!0,i.BOOLEAN],filePosterCalculateAverageImageColor:[!1,i.BOOLEAN]}}};return"undefined"!=typeof window&&void 0!==window.document&&document.dispatchEvent(new CustomEvent("FilePond:pluginloaded",{detail:s})),s});
